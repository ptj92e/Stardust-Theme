{"ast":null,"code":"import React, { useRef, useState, useImperativeHandle, useCallback, useEffect } from 'react';\nimport { PageFlip } from 'page-flip';\nconst HTMLFlipBookForward = React.forwardRef((props, ref) => {\n  const htmlElementRef = useRef(null);\n  const childRef = useRef([]);\n  const pageFlip = useRef();\n  const [pages, setPages] = useState([]);\n  useImperativeHandle(ref, () => ({\n    pageFlip: () => pageFlip.current\n  }));\n  const refreshOnPageDelete = useCallback(() => {\n    if (pageFlip.current) {\n      pageFlip.current.clear();\n    }\n  }, []);\n  const removeHandlers = useCallback(() => {\n    const flip = pageFlip.current;\n    if (flip) {\n      flip.off('flip');\n      flip.off('changeOrientation');\n      flip.off('changeState');\n      flip.off('init');\n      flip.off('update');\n    }\n  }, []);\n  useEffect(() => {\n    childRef.current = [];\n    if (props.children) {\n      const childList = React.Children.map(props.children, child => {\n        return React.cloneElement(child, {\n          ref: dom => {\n            if (dom) {\n              childRef.current.push(dom);\n            }\n          }\n        });\n      });\n      if (!props.renderOnlyPageLengthChange || pages.length !== childList.length) {\n        if (childList.length < pages.length) {\n          refreshOnPageDelete();\n        }\n        setPages(childList);\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [props.children]);\n  useEffect(() => {\n    const setHandlers = () => {\n      const flip = pageFlip.current;\n      if (flip) {\n        if (props.onFlip) {\n          flip.on('flip', e => props.onFlip(e));\n        }\n        if (props.onChangeOrientation) {\n          flip.on('changeOrientation', e => props.onChangeOrientation(e));\n        }\n        if (props.onChangeState) {\n          flip.on('changeState', e => props.onChangeState(e));\n        }\n        if (props.onInit) {\n          flip.on('init', e => props.onInit(e));\n        }\n        if (props.onUpdate) {\n          flip.on('update', e => props.onUpdate(e));\n        }\n      }\n    };\n    if (pages.length > 0 && childRef.current.length > 0) {\n      removeHandlers();\n      if (htmlElementRef.current && !pageFlip.current) {\n        pageFlip.current = new PageFlip(htmlElementRef.current, props);\n      }\n      if (!pageFlip.current.getFlipController()) {\n        pageFlip.current.loadFromHTML(childRef.current);\n      } else {\n        pageFlip.current.updateFromHtml(childRef.current);\n      }\n      setHandlers();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [pages]);\n  return React.createElement(\"div\", {\n    ref: htmlElementRef,\n    className: props.className,\n    style: props.style\n  }, pages);\n});\nconst HTMLFlipBook = React.memo(HTMLFlipBookForward);\nexport default HTMLFlipBook;","map":{"version":3,"names":["HTMLFlipBookForward","React","forwardRef","props","ref","htmlElementRef","useRef","childRef","pageFlip","pages","setPages","useState","useImperativeHandle","current","refreshOnPageDelete","useCallback","clear","removeHandlers","flip","off","useEffect","children","childList","Children","map","child","cloneElement","dom","push","renderOnlyPageLengthChange","length","setHandlers","onFlip","on","e","onChangeOrientation","onChangeState","onInit","onUpdate","PageFlip","getFlipController","loadFromHTML","updateFromHtml","createElement","className","style","HTMLFlipBook","memo"],"sources":["../src/html-flip-book/index.tsx"],"sourcesContent":["import React, {\n    ReactElement,\n    useCallback,\n    useEffect,\n    useImperativeHandle,\n    useRef,\n    useState,\n} from 'react';\n\nimport { PageFlip } from 'page-flip';\nimport { IFlipSetting, IEventProps } from './settings';\n\ninterface IProps extends IFlipSetting, IEventProps {\n    className: string;\n    style: React.CSSProperties;\n    children: React.ReactNode;\n    renderOnlyPageLengthChange?: boolean;\n}\n\nconst HTMLFlipBookForward = React.forwardRef(\n    (props: IProps, ref: React.MutableRefObject<PageFlip>) => {\n        const htmlElementRef = useRef<HTMLDivElement>(null);\n        const childRef = useRef<HTMLElement[]>([]);\n        const pageFlip = useRef<PageFlip>();\n\n        const [pages, setPages] = useState<ReactElement[]>([]);\n\n        useImperativeHandle(ref, () => ({\n            pageFlip: () => pageFlip.current,\n        }));\n\n        const refreshOnPageDelete = useCallback(() => {\n            if (pageFlip.current) {\n                pageFlip.current.clear();\n            }\n        }, []);\n\n        const removeHandlers = useCallback(() => {\n            const flip = pageFlip.current;\n\n            if (flip) {\n                flip.off('flip');\n                flip.off('changeOrientation');\n                flip.off('changeState');\n                flip.off('init');\n                flip.off('update');\n            }\n        }, []);\n\n        useEffect(() => {\n            childRef.current = [];\n\n            if (props.children) {\n                const childList = React.Children.map(props.children, (child) => {\n                    return React.cloneElement(child as ReactElement, {\n                        ref: (dom) => {\n                            if (dom) {\n                                childRef.current.push(dom);\n                            }\n                        },\n                    });\n                });\n\n                if (!props.renderOnlyPageLengthChange || pages.length !== childList.length) {\n                    if (childList.length < pages.length) {\n                        refreshOnPageDelete();\n                    }\n\n                    setPages(childList);\n                }\n            }\n            // eslint-disable-next-line react-hooks/exhaustive-deps\n        }, [props.children]);\n\n        useEffect(() => {\n            const setHandlers = () => {\n                const flip = pageFlip.current;\n\n                if (flip) {\n                    if (props.onFlip) {\n                        flip.on('flip', (e: unknown) => props.onFlip(e));\n                    }\n\n                    if (props.onChangeOrientation) {\n                        flip.on('changeOrientation', (e: unknown) => props.onChangeOrientation(e));\n                    }\n\n                    if (props.onChangeState) {\n                        flip.on('changeState', (e: unknown) => props.onChangeState(e));\n                    }\n\n                    if (props.onInit) {\n                        flip.on('init', (e: unknown) => props.onInit(e));\n                    }\n\n                    if (props.onUpdate) {\n                        flip.on('update', (e: unknown) => props.onUpdate(e));\n                    }\n                }\n            };\n\n            if (pages.length > 0 && childRef.current.length > 0) {\n                removeHandlers();\n\n                if (htmlElementRef.current && !pageFlip.current) {\n                    pageFlip.current = new PageFlip(htmlElementRef.current, props);\n                }\n\n                if (!pageFlip.current.getFlipController()) {\n                    pageFlip.current.loadFromHTML(childRef.current);\n                } else {\n                    pageFlip.current.updateFromHtml(childRef.current);\n                }\n\n                setHandlers();\n            }\n            // eslint-disable-next-line react-hooks/exhaustive-deps\n        }, [pages]);\n\n        return (\n            <div ref={htmlElementRef} className={props.className} style={props.style}>\n                {pages}\n            </div>\n        );\n    }\n);\n\nexport const HTMLFlipBook = React.memo(HTMLFlipBookForward);\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}